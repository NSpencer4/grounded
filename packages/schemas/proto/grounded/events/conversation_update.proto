syntax = "proto3";

package grounded.events;

import "google/protobuf/struct.proto";
import "grounded/common/types.proto";
import "grounded/models/conversation.proto";

option java_package = "com.grounded.events";

// Update event details (separate from base event to allow literal type)
message UpdateEventDetails {
  string id = 1;                    // UUID
  string type = 2;                  // Literal: "CONVERSATION_UPDATE"
  string schema_version = 3;
}

// Update metadata (uses string timestamp for ISO8601 compatibility)
message UpdateMetadata {
  string correlation_id = 1;
  string created_at = 2;            // ISO8601 string
}

// Update content for client streaming
message Update {
  grounded.common.UpdateType type = 1;
  string content = 2;
  optional google.protobuf.Struct metadata = 3;  // Flexible key-value data
}

// Event produced by responder for client streaming via Durable Objects
message ConversationUpdateEvent {
  UpdateEventDetails event = 1;
  grounded.models.ConversationRef conversation = 2;
  Update update = 3;
  UpdateMetadata metadata = 4;
}
